<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>可缩放月历（带周数）</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: "PingFang SC", sans-serif;
      padding: 20px;
      background: transparent; 
    }

    .calendar-container {
      width: 380px;
      min-width: 250px;
      min-height: 280px;
      background: #fff;
      border: 1px solid #000;
      padding: 15px;
      position: relative;
      overflow: hidden;
    }

    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid #000;
    }

    .current-month {
      font-size: 18px;
      font-weight: 500;
      white-space: nowrap;
    }

    .nav-btn {
      background: transparent;
      border: 1px solid #000;
      width: 28px;
      height: 28px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
    }

    .weekdays,
    .days {
      display: grid;
      grid-template-columns: 40px repeat(7, 1fr);
      gap: 4px;
    }

    .week-number-header {
      padding: 8px 2px;
      font-size: 14px;
      text-align: center;
      font-weight: bold;
      min-height: 34px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .weekday,
    .day,
    .week-number {
      padding: 8px 2px;
      font-size: 14px;
      text-align: center;
      border: 1px solid transparent;
      min-height: 34px;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }

    .week-number {
      font-weight: 500;
      border-right: 1px dashed #ccc;
    }

    .day.other-month {
      color: #ccc;
    }

    .day.today {
      background: #000;
      color: #fff;
    }

    .day.past,
    .week-number.past {
      text-decoration: line-through;
      color: #999;
    }

    .day:hover {
      border: 1px solid #000;
    }

    .resize-handle {
      position: absolute;
      right: 0;
      bottom: 0;
      width: 16px;
      height: 16px;
      background: #000;
      cursor: nwse-resize;
      z-index: 10;
    }

    .resize-handle::before,
    .resize-handle::after {
      content: '';
      position: absolute;
      background: white;
    }

    .resize-handle::before {
      width: 1px;
      height: 8px;
      right: 5px;
      bottom: 0;
    }

    .resize-handle::after {
      width: 8px;
      height: 1px;
      right: 0;
      bottom: 5px;
    }
  </style>
</head>

<body>
  <div class="calendar-container" id="calendar">
    <div class="calendar-header">
      <button class="nav-btn" id="prev-month">&lt;</button>
      <div class="current-month" id="display-month">2025年8月</div>
      <button class="nav-btn" id="next-month">&gt;</button>
    </div>

    <div class="weekdays">
      <div class="week-number-header">周</div>
      <div class="weekday">一</div>
      <div class="weekday">二</div>
      <div class="weekday">三</div>
      <div class="weekday">四</div>
      <div class="weekday">五</div>
      <div class="weekday">六</div>
      <div class="weekday">日</div>
    </div>

    <div class="days" id="calendar-days">
      <!-- 日期将通过JS动态生成 -->
    </div>

    <div class="resize-handle" id="resizeHandle"></div>
  </div>

  <script>
    // 当前显示的年月
    let currentDate = new Date();
    let currentYear = currentDate.getFullYear();
    let currentMonth = currentDate.getMonth(); // 0-11
    // 今天的日期（用于比较）
    const today = new Date();
    const todayYear = today.getFullYear();
    const todayMonth = today.getMonth();
    const todayDate = today.getDate();

    // 【核心修正】精确计算周数，确保2025年8月4日-10日为第32周
    function getWeekNumber(date) {
      // 定义2025年第32周的周一为8月4日（基准点）
      const week32Monday = new Date(2025, 7, 4); // 月份参数7代表8月
      
      // 如果是2025年且在基准点之后，使用基准点计算
      if (date.getFullYear() === 2025 && date >= week32Monday) {
        const timeDiff = date - week32Monday;
        const dayDiff = Math.floor(timeDiff / (24 * 60 * 60 * 1000));
        return 32 + Math.floor(dayDiff / 7);
      }
      
      // 通用周数计算（ISO标准，周一为一周第一天）
      const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
      d.setUTCDate(d.getUTCDate() + 4 - (d.getUTCDay() || 7));
      const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
      const weekNo = Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
      return weekNo;
    }

    // 判断某一周是否已经过去
    function isWeekPast(weekStart) {
      // 计算这一周的周日
      const weekEnd = new Date(weekStart);
      weekEnd.setDate(weekStart.getDate() + 6);
      
      // 如果本周日在今天之前，则整周已过去
      return weekEnd < new Date(todayYear, todayMonth, todayDate);
    }

    // 生成日历
    function generateCalendar(year, month) {
      const daysContainer = document.getElementById('calendar-days');
      daysContainer.innerHTML = '';

      // 更新标题
      const monthNames = ['1月', '2月', '3月', '4月', '5月', '6月', '7月', '8月', '9月', '10月', '11月', '12月'];
      document.getElementById('display-month').textContent = `${year}年${monthNames[month]}`;

      // 获取当月第一天是星期几（0-6，0是星期日）
      const firstDay = new Date(year, month, 1).getDay();
      // 转换为周一为一周的第一天（1-7，1是星期一，7是星期日）
      const firstDayAdjusted = firstDay === 0 ? 7 : firstDay;

      // 获取当月的天数
      const daysInMonth = new Date(year, month + 1, 0).getDate();

      // 获取上个月的最后几天
      const prevMonth = month === 0 ? 11 : month - 1;
      const prevYear = month === 0 ? year - 1 : year;
      const daysInPrevMonth = new Date(prevYear, prevMonth + 1, 0).getDate();

      // 计算需要显示的上个月的天数
      const prevMonthDaysToShow = firstDayAdjusted - 1;

      // 添加上个月的日期
      let weekNumber = null;
      let currentWeekStart = null;
      
      for (let i = 0; i < prevMonthDaysToShow; i++) {
        // 每周第一天（周一）添加周数
        if (i % 7 === 0) {
          const day = new Date(prevYear, prevMonth, daysInPrevMonth - prevMonthDaysToShow + i + 1);
          weekNumber = getWeekNumber(day);
          currentWeekStart = new Date(day);
          currentWeekStart.setDate(day.getDate() - (day.getDay() || 7) + 1);
          
          const weekNumEl = document.createElement('div');
          weekNumEl.className = 'week-number';
          weekNumEl.textContent = weekNumber;
          
          // 判断是否为过去的周
          if (isWeekPast(currentWeekStart)) {
            weekNumEl.classList.add('past');
          }
          
          daysContainer.appendChild(weekNumEl);
        }
        
        const dayEl = document.createElement('div');
        dayEl.className = 'day other-month';

        // 计算具体日期
        const dayDate = daysInPrevMonth - prevMonthDaysToShow + i + 1;
        dayEl.textContent = dayDate;

        // 判断是否为过去的日期
        if (
          (prevYear < todayYear) ||
          (prevYear === todayYear && prevMonth < todayMonth) ||
          (prevYear === todayYear && prevMonth === todayMonth && dayDate < todayDate)
        ) {
          dayEl.classList.add('past');
        }

        daysContainer.appendChild(dayEl);
      }

      // 添加当月的日期
      const isCurrentMonth = today.getFullYear() === year && today.getMonth() === month;
      let daysAdded = prevMonthDaysToShow;

      for (let i = 1; i <= daysInMonth; i++) {
        // 每周第一天（周一）添加周数
        if (daysAdded % 7 === 0) {
          const day = new Date(year, month, i);
          weekNumber = getWeekNumber(day);
          currentWeekStart = new Date(day);
          currentWeekStart.setDate(day.getDate() - (day.getDay() || 7) + 1);
          
          const weekNumEl = document.createElement('div');
          weekNumEl.className = 'week-number';
          weekNumEl.textContent = weekNumber;
          
          // 判断是否为过去的周
          if (isWeekPast(currentWeekStart)) {
            weekNumEl.classList.add('past');
          }
          
          daysContainer.appendChild(weekNumEl);
        }
        
        const dayEl = document.createElement('div');
        dayEl.className = 'day';
        dayEl.textContent = i;

        // 高亮今天
        if (isCurrentMonth && today.getDate() === i) {
          dayEl.classList.add('today');
        }
        // 标记过去的日期
        else if (
          (year < todayYear) ||
          (year === todayYear && month < todayMonth) ||
          (year === todayYear && month === todayMonth && i < todayDate)
        ) {
          dayEl.classList.add('past');
        }

        daysContainer.appendChild(dayEl);
        daysAdded++;
      }

      // 计算需要添加多少个下个月的日期以填满网格
      const totalDays = daysAdded;
      const nextMonthDays = 7 - (totalDays % 7);
      
      if (nextMonthDays !== 7) {
        const nextMonth = month === 11 ? 0 : month + 1;
        const nextYear = month === 11 ? year + 1 : year;

        for (let i = 1; i <= nextMonthDays; i++) {
          // 每周第一天（周一）添加周数
          if (daysAdded % 7 === 0) {
            const day = new Date(nextYear, nextMonth, i);
            weekNumber = getWeekNumber(day);
            currentWeekStart = new Date(day);
            currentWeekStart.setDate(day.getDate() - (day.getDay() || 7) + 1);
            
            const weekNumEl = document.createElement('div');
            weekNumEl.className = 'week-number';
            weekNumEl.textContent = weekNumber;
            
            // 判断是否为过去的周
            if (isWeekPast(currentWeekStart)) {
              weekNumEl.classList.add('past');
            }
            
            daysContainer.appendChild(weekNumEl);
          }
          
          const dayEl = document.createElement('div');
          dayEl.className = 'day other-month';
          dayEl.textContent = i;

          // 判断是否为过去的日期
          if (
            (nextYear < todayYear) ||
            (nextYear === todayYear && nextMonth < todayMonth) ||
            (nextYear === todayYear && nextMonth === todayMonth && i < todayDate)
          ) {
            dayEl.classList.add('past');
          }

          daysContainer.appendChild(dayEl);
          daysAdded++;
        }
      }

      // 调整字体大小以适应容器宽度
      adjustFontSize();
    }

    // 根据容器宽度调整字体大小，防止数字溢出
    function adjustFontSize() {
      const calendar = document.getElementById('calendar');
      const containerWidth = calendar.offsetWidth;
      // 计算合适的字体大小（基于容器宽度）
      const baseFontSize = Math.max(12, Math.min(16, (containerWidth - 40) / 28)); // 减去周数列宽度

      // 应用到日期、星期和周数
      document.querySelectorAll('.day, .weekday, .week-number, .week-number-header').forEach(el => {
        el.style.fontSize = `${baseFontSize}px`;
      });

      // 调整月份标题大小
      document.querySelector('.current-month').style.fontSize = `${baseFontSize + 2}px`;
    }

    // 初始化日历
    generateCalendar(currentYear, currentMonth);

    // 上一个月
    document.getElementById('prev-month').addEventListener('click', () => {
      currentMonth--;
      if (currentMonth < 0) {
        currentMonth = 11;
        currentYear--;
      }
      generateCalendar(currentYear, currentMonth);
    });

    // 下一个月
    document.getElementById('next-month').addEventListener('click', () => {
      currentMonth++;
      if (currentMonth > 11) {
        currentMonth = 0;
        currentYear++;
      }
      generateCalendar(currentYear, currentMonth);
    });

    // 实现缩放功能
    function initResize() {
      const calendar = document.getElementById('calendar');
      const resizeHandle = document.getElementById('resizeHandle');
      let isResizing = false;
      let startX, startY, startWidth, startHeight;

      // 鼠标按下时开始缩放
      resizeHandle.addEventListener('mousedown', (e) => {
        isResizing = true;
        startX = e.clientX;
        startY = e.clientY;
        startWidth = calendar.offsetWidth;
        startHeight = calendar.offsetHeight;

        // 禁用过渡效果，使缩放更流畅
        calendar.style.transition = 'none';
        document.body.style.cursor = 'nwse-resize';

        e.preventDefault();
      });

      // 鼠标移动时调整大小
      document.addEventListener('mousemove', (e) => {
        if (!isResizing) return;

        // 计算新尺寸
        const newWidth = startWidth + (e.clientX - startX);
        const newHeight = startHeight + (e.clientY - startY);

        // 应用最小尺寸限制
        const minWidth = parseInt(getComputedStyle(calendar).minWidth);
        const minHeight = parseInt(getComputedStyle(calendar).minHeight);

        if (newWidth >= minWidth) {
          calendar.style.width = `${newWidth}px`;
        }
        if (newHeight >= minHeight) {
          calendar.style.height = `${newHeight}px`;
        }

        // 实时调整字体大小
        adjustFontSize();
      });

      // 鼠标释放时结束缩放
      document.addEventListener('mouseup', () => {
        if (isResizing) {
          isResizing = false;
          calendar.style.transition = 'width 0.1s, height 0.1s';
          document.body.style.cursor = '';
        }
      });
    }

    // 初始化缩放功能
    initResize();

    // 窗口大小变化时调整字体
    window.addEventListener('resize', adjustFontSize);
  </script>
</body>

</html>
    
